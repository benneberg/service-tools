<!doctype html>
<html lang="en" class="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DISE — Support Tools</title>
<script src="https://cdn.tailwindcss.com?plugins=forms"></script>
<style>
  body { font-family: Inter, sans-serif; }
  .tab.active { @apply bg-accent shadow-md text-white; }
  .slide-in-bottom { animation: slideInBottom 0.3s ease-out; }
  .slide-out-bottom { animation: slideOutBottom 0.3s ease-in forwards; }
  @keyframes slideInBottom { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
  @keyframes slideOutBottom { from {opacity:1; transform:translateY(0);} to {opacity:0; transform:translateY(20px);} }
</style>
</head>
<body class="bg-gray-900 text-gray-200">
<div class="wrap min-h-screen w-full p-4 sm:p-8 flex flex-col items-center">

  <header class="flex w-full max-w-4xl items-center gap-4 py-4">
    <div class="text-5xl font-bold tracking-tighter text-white">dise</div>
    <div class="border-l border-gray-700 pl-4">
      <h1 class="text-lg font-semibold text-white">Support Tools</h1>
      <p class="text-sm text-gray-400">Partner first. Partner only.</p>
    </div>
  </header>

  <!-- === Tool Selector === -->
  <div class="flex gap-2 p-3 border-b border-gray-700/50" role="tablist" aria-label="Support Tools">
    <button class="tool-tab active flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all" data-tool="provision">Provisioning</button>
    <button class="tool-tab flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-400 hover:bg-gray-700/50 hover:text-gray-200 transition-all" data-tool="signageos">SignageOS Unlock</button>
  </div>

  <div class="tool-panels mt-4 w-full max-w-4xl">

    <!-- === Provisioning Tool === -->
    <div class="tool-panel" id="tool-provision">
      <div class="tabs flex gap-2 p-3 border-b border-gray-700/50">
        <button class="tab active flex-1 py-2 px-4 rounded-md text-sm font-medium" data-tab="provision-script">Script</button>
        <button class="tab flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-400 hover:bg-gray-700/50 hover:text-gray-200" data-tab="provision-readme">Readme</button>
      </div>
      <div class="tab-panels p-4 sm:p-6 min-h-[400px]">
        <div class="tab-panel" id="panel-provision-script">
          <pre class="bg-gray-800 p-4 rounded text-sm text-gray-300 overflow-auto">#!/bin/bash
# Provisioning script placeholder
echo "Run your provisioning commands here..."</pre>
        </div>
        <div class="tab-panel hidden" id="panel-provision-readme">
          <div class="prose prose-invert prose-sm max-w-none text-gray-300">
            <h3 class="text-white">Provisioning Tool</h3>
            <p>Instructions for provisioning Google Workspace / Cloud for signageOS.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- === SignageOS Unlock Tool === -->
    <div class="tool-panel hidden" id="tool-signageos">
      <div class="tabs flex gap-2 p-3 border-b border-gray-700/50">
        <button class="tab active flex-1 py-2 px-4 rounded-md text-sm font-medium" data-tab="script">Script</button>
        <button class="tab flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-400 hover:bg-gray-700/50 hover:text-gray-200" data-tab="readme">Readme</button>
      </div>
      <div class="tab-panels p-4 sm:p-6 min-h-[400px]">
        <div class="tab-panel" id="panel-script">
          <div class="card bg-gray-900/80 rounded-lg p-4">
            <strong class="text-white">SignageOS Device Unlock Script</strong>
            <div class="text-sm text-gray-400 mt-1 mb-2">
              Enter Device ID and Policy ID, then click Run.
            </div>
            <input type="text" id="deviceId" placeholder="Device ID" class="w-full mb-2 p-2 rounded-md bg-gray-800 border border-gray-700 text-gray-200" />
            <input type="text" id="policyId" placeholder="Policy ID" class="w-full mb-4 p-2 rounded-md bg-gray-800 border border-gray-700 text-gray-200" />
            <button id="runUnlock" class="bg-accent px-4 py-2 rounded-md text-white hover:bg-green-600 transition">Run</button>
            <pre class="mt-4 p-2 bg-gray-800 rounded text-sm text-gray-300 overflow-auto" id="output"></pre>
          </div>
        </div>
        <div class="tab-panel hidden" id="panel-readme">
          <div class="prose prose-invert prose-sm max-w-none text-gray-300">
            <h3 class="text-white">Manual Instructions</h3>
            <ul>
              <li>Log into SignageOS admin account.</li>
              <li>Navigate to Organizations → [Target Org] → Devices.</li>
              <li>Select the device and open Policies.</li>
              <li>Remove the Standalone Mode Locked policy.</li>
              <li>Verify removal and inform the partner.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>

  <footer class="mt-8 py-4 text-center text-gray-500 text-sm">
    Partner support: <a href="mailto:support@dise.com" class="text-gray-400 hover:text-accent transition">support@dise.com</a>
  </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Tool Tabs
  const toolTabs = document.querySelectorAll('.tool-tab');
  const toolPanels = document.querySelectorAll('.tool-panel');
  toolTabs.forEach(tab => tab.addEventListener('click', () => {
    toolTabs.forEach(t => t.classList.remove('active'));
    toolTabs.forEach(t => t.classList.add('text-gray-400', 'hover:bg-gray-700/50', 'hover:text-gray-200'));
    tab.classList.add('active');
    tab.classList.remove('text-gray-400', 'hover:bg-gray-700/50', 'hover:text-gray-200');
    toolPanels.forEach(p => p.classList.add('hidden'));
    document.getElementById(`tool-${tab.dataset.tool}`).classList.remove('hidden');
  }));

  // Inner Tabs
  const tabContainers = document.querySelectorAll('.tool-panel');
  tabContainers.forEach(container => {
    const tabs = container.querySelectorAll('.tab');
    const panels = container.querySelectorAll('.tab-panel');
    tabs.forEach(t => t.addEventListener('click', () => {
      tabs.forEach(x => x.classList.remove('active'));
      panels.forEach(p => p.classList.add('hidden'));
      t.classList.add('active');
      document.getElementById(`panel-${t.dataset.tab}`).classList.remove('hidden');
    }));
  });

  // Unlock Script
  const runBtn = document.getElementById('runUnlock');
  runBtn.addEventListener('click', async () => {
    const deviceId = document.getElementById('deviceId').value.trim();
    const policyId = document.getElementById('policyId').value.trim();
    const output = document.getElementById('output');
    if(!deviceId || !policyId) { output.textContent="⚠️ Fill all fields"; return; }
    output.textContent="Running...";
    try {
      const resp = await fetch('/unlock-device', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({deviceId, policyId})
      });
      const data = await resp.json();
      output.textContent = resp.ok ? `✅ ${data.message}` : `❌ ${data.message}`;
    } catch(e) { output.textContent = `❌ ${e.message}`; }
  });
});
</script>
</body>
</html>
